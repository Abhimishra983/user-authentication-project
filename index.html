<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>User Authentication</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
  <div class="bg-white shadow-xl rounded-lg p-8 w-full max-w-md transition-all duration-300">
    <div class="flex justify-center mb-6">
      <h2 class="text-3xl font-bold text-center text-gray-800" id="formTitle">Login</h2>
    </div>

    <!-- Login Form -->
    <form id="loginForm" class="space-y-4">
      <div class="relative">
        <input type="email" id="loginEmail" placeholder="Email" class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required />
        <i class="fas fa-envelope absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
      </div>
      
      <div class="relative">
        <input type="password" id="loginPassword" placeholder="Password" class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent pr-10" required />
        <i class="fas fa-eye-slash absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 cursor-pointer toggle-password" data-target="loginPassword"></i>
      </div>
      
      <div class="flex items-center justify-between">
        <div class="flex items-center">
          <input type="checkbox" id="rememberMe" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
          <label for="rememberMe" class="ml-2 block text-sm text-gray-700">Remember me</label>
        </div>
        <a href="#" id="switchToForgot" class="text-sm text-blue-600 hover:text-blue-800 hover:underline">Forgot Password?</a>
      </div>
      
      <button type="submit" class="w-full bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-300">
        Login
      </button>
      
      <p class="text-sm text-center text-gray-600">
        Don't have an account? <a href="#" id="switchToRegister" class="text-blue-600 font-medium hover:underline">Register</a>
      </p>
    </form>

    <!-- Register Form -->
    <form id="registerForm" class="space-y-4 hidden">
      <div class="relative">
        <input type="text" id="registerUsername" placeholder="Username" class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" required />
        <i class="fas fa-user absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
      </div>
      
      <div class="relative">
        <input type="email" id="registerEmail" placeholder="Email" class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" required />
        <i class="fas fa-envelope absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
      </div>
      
      <div class="relative">
        <input type="password" id="registerPassword" placeholder="Password" class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent pr-10" required />
        <i class="fas fa-eye-slash absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 cursor-pointer toggle-password" data-target="registerPassword"></i>
      </div>
      
      <div class="relative">
        <input type="password" id="registerConfirmPassword" placeholder="Confirm Password" class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent pr-10" required />
        <i class="fas fa-eye-slash absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 cursor-pointer toggle-password" data-target="registerConfirmPassword"></i>
      </div>
      
      <button type="submit" class="w-full bg-green-600 text-white p-3 rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors duration-300">
        Register
      </button>
      
      <p class="text-sm text-center text-gray-600">
        Already have an account? <a href="#" id="switchToLogin" class="text-blue-600 font-medium hover:underline">Login</a>
      </p>
    </form>

    <!-- Forgot Password Form -->
    <form id="forgotForm" class="space-y-4 hidden">
      <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4">
        <div class="flex">
          <div class="flex-shrink-0">
            <i class="fas fa-exclamation-circle text-yellow-400"></i>
          </div>
          <div class="ml-3">
            <p class="text-sm text-yellow-700">Enter your email and new password to reset.</p>
          </div>
        </div>
      </div>
      
      <div class="relative">
        <input type="email" id="forgotEmail" placeholder="Email" class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent" required />
        <i class="fas fa-envelope absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
      </div>
      
      <div class="relative">
        <input type="password" id="forgotNewPassword" placeholder="New Password" class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent pr-10" required />
        <i class="fas fa-eye-slash absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 cursor-pointer toggle-password" data-target="forgotNewPassword"></i>
      </div>
      
      <div class="relative">
        <input type="password" id="forgotConfirmPassword" placeholder="Confirm New Password" class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent pr-10" required />
        <i class="fas fa-eye-slash absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 cursor-pointer toggle-password" data-target="forgotConfirmPassword"></i>
      </div>
      
      <button type="submit" class="w-full bg-yellow-600 text-white p-3 rounded-lg hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2 transition-colors duration-300">
        Reset Password
      </button>
      
      <p class="text-sm text-center text-gray-600">
        Remember your password? <a href="#" id="switchToLoginFromForgot" class="text-blue-600 font-medium hover:underline">Login</a>
      </p>
    </form>

    <!-- Success/Error Message Box -->
    <div id="messageBox" class="mt-4 p-4 rounded-lg hidden"></div>
  </div>

<script>
// Toggle password visibility
document.querySelectorAll('.toggle-password').forEach(icon => {
  icon.addEventListener('click', function() {
    const targetId = this.getAttribute('data-target');
    const input = document.getElementById(targetId);
    const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
    input.setAttribute('type', type);
    this.classList.toggle('fa-eye-slash');
    this.classList.toggle('fa-eye');
  });
});

// Form switching function
function switchForm(show, hide1, hide2, title) {
  document.getElementById(show).classList.remove("hidden");
  document.getElementById(hide1).classList.add("hidden");
  document.getElementById(hide2).classList.add("hidden");
  document.getElementById("formTitle").innerText = title;
  clearMessage();
}

// Prevent default link behavior & switch form
document.getElementById("switchToRegister").addEventListener("click", e => {
  e.preventDefault();
  switchForm("registerForm", "loginForm", "forgotForm", "Register");
});
document.getElementById("switchToLogin").addEventListener("click", e => {
  e.preventDefault();
  switchForm("loginForm", "registerForm", "forgotForm", "Login");
});
document.getElementById("switchToForgot").addEventListener("click", e => {
  e.preventDefault();
  switchForm("forgotForm", "loginForm", "registerForm", "Reset Password");
});
document.getElementById("switchToLoginFromForgot").addEventListener("click", e => {
  e.preventDefault();
  switchForm("loginForm", "registerForm", "forgotForm", "Login");
});

// Show message with animation
function showMessage(msg, success = false) {
  const box = document.getElementById("messageBox");
  box.textContent = msg;
  box.className = `mt-4 p-4 rounded-lg ${success ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`;
  box.classList.remove("hidden");
  
  // Auto-hide after 5 seconds
  setTimeout(() => {
    box.classList.add("opacity-0");
    setTimeout(() => box.classList.add("hidden"), 300);
  }, 5000);
}

function clearMessage() {
  const box = document.getElementById("messageBox");
  box.classList.add("hidden");
  box.classList.remove("opacity-0");
}

// Password validation helper
function validatePassword(password, confirmPassword) {
  if (password !== confirmPassword) {
    showMessage("Passwords do not match");
    return false;
  }
  if (password.length < 8) {
    showMessage("Password must be at least 8 characters long");
    return false;
  }
  return true;
}

// Register submit
document.getElementById("registerForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  clearMessage();
  
  const username = document.getElementById("registerUsername").value.trim();
  const email = document.getElementById("registerEmail").value.trim();
  const password = document.getElementById("registerPassword").value.trim();
  const confirmPassword = document.getElementById("registerConfirmPassword").value.trim();

  if (!validatePassword(password, confirmPassword)) return;

  try {
    // Show loading state
    const btn = e.target.querySelector('button[type="submit"]');
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Registering...';
    
    const res = await fetch("/register", {
      method: "POST", 
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, email, password })
    });
    
    const data = await res.json();
    showMessage(data.message, data.success);
    
    if(data.success){
      // Reset form and switch to login after 2 seconds
      e.target.reset();
      setTimeout(() => switchForm("loginForm", "registerForm", "forgotForm", "Login"), 2000);
    }
  } catch (err) {
    showMessage("Network error, try again later");
  } finally {
    // Reset button state
    const btn = e.target.querySelector('button[type="submit"]');
    btn.disabled = false;
    btn.textContent = 'Register';
  }
});

// Login submit
document.getElementById("loginForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  clearMessage();
  
  const email = document.getElementById("loginEmail").value.trim();
  const password = document.getElementById("loginPassword").value.trim();
  const rememberMe = document.getElementById("rememberMe").checked;

  try {
    // Show loading state
    const btn = e.target.querySelector('button[type="submit"]');
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Logging in...';
    
    const res = await fetch("/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password, rememberMe })
    });
    
    const data = await res.json();
    showMessage(data.message, data.success);
    
    if(data.success){
      // Redirect to dashboard or home page
      window.location.href = "/dashboard";
    }
  } catch (err) {
    showMessage("Network error, try again later");
  } finally {
    // Reset button state
    const btn = e.target.querySelector('button[type="submit"]');
    btn.disabled = false;
    btn.textContent = 'Login';
  }
});

// Forgot password submit
document.getElementById("forgotForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  clearMessage();
  
  const email = document.getElementById("forgotEmail").value.trim();
  const newPassword = document.getElementById("forgotNewPassword").value.trim();
  const confirmPassword = document.getElementById("forgotConfirmPassword").value.trim();

  if (!validatePassword(newPassword, confirmPassword)) return;

  try {
    // Show loading state
    const btn = e.target.querySelector('button[type="submit"]');
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Resetting...';
    
    const res = await fetch("/forgot-password", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, newPassword })
    });
    
    const data = await res.json();
    showMessage(data.message, data.success);
    
    if(data.success){
      // Reset form and switch to login after 2 seconds
      e.target.reset();
      setTimeout(() => switchForm("loginForm", "registerForm", "forgotForm", "Login"), 2000);
    }
  } catch (err) {
    showMessage("Network error, try again later");
  } finally {
    // Reset button state
    const btn = e.target.querySelector('button[type="submit"]');
    btn.disabled = false;
    btn.textContent = 'Reset Password';
  }
});
</script>
</body>
</html>